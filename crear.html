<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <title>Crear / Editor â€” Historias Ã‰picas</title>
  <link rel="stylesheet" href="style.css">
  <script defer src="editor.js"></script>
  <script>
    // Al cargar la pÃ¡gina, si hay texto temporal (subido desde panel), lo colocamos
    window.addEventListener("DOMContentLoaded", () => {
      const texto = localStorage.getItem("historiaTemporal");
      if (texto) {
        const zona = document.getElementById("zona");
        zona.innerText = texto;
        localStorage.removeItem("historiaTemporal");
      }
      // Ajustar padding-top segÃºn altura de toolbar (por si cambia)
      const tb = document.querySelector('.toolbar');
      if (tb) document.body.style.paddingTop = tb.offsetHeight + 'px';
    });
  </script>
</head>
<body>
  <!-- Barra de herramientas (fija) -->
  <div class="toolbar" role="toolbar" aria-label="Barra de herramientas">
    <select id="fuente" onchange="cambiarFuente()">
      <option>Calibri</option>
      <option>Times New Roman</option>
      <option>Arial</option>
      <option>Verdana</option>
      <option>Georgia</option>
      <option>"Comic Sans MS"</option>
      <option>"Courier New"</option>
      <option>"Trebuchet MS"</option>
    </select>

    <select id="tamano" onchange="cambiarTamano()">
      <option value="11px">11px</option>
      <option value="12px">12px</option>
      <option value="14px" selected>14px</option>
      <option value="16px">16px</option>
      <option value="18px">18px</option>
      <option value="20px">20px</option>
      <option value="24px">24px</option>
      <option value="28px">28px</option>
      <option value="32px">32px</option>
    </select>

    <button onclick="formato('bold')" title="Negrita">B</button>
    <button onclick="formato('italic')" title="Cursiva">I</button>
    <button onclick="formato('underline')" title="Subrayado">U</button>

    <input type="color" id="color" onchange="cambiarColor()" title="Color de texto">

    <input type="file" accept=".txt" onchange="abrirArchivo(event)" title="Abrir .txt">

    <button onclick="insertar('figura')">Insertar figura</button>
    <button onclick="insertar('imagen')">Insertar imagen</button>
    <button onclick="insertar('audio')">Insertar audio</button>
    <button onclick="insertar('video')">Insertar video</button>

    <button onclick="mostrarModal()" class="publicar-btn">ğŸ“¤ Publicar</button>
  </div>

  <!-- Zona unificada: izquierda (columna negra), centro (zona blanca), derecha (columna negra) -->
  <div class="zona-unificada" id="zona-trabajo">
    <div class="columna izquierda" contenteditable="true" data-area="izq"></div>
    <div class="separador"></div>
    <div class="zona-texto" id="zona" contenteditable="true">Escribe aquÃ­ tu historia...</div>
    <div class="separador"></div>
    <div class="columna derecha" contenteditable="true" data-area="der"></div>
  </div>

  <!-- Modal publicar (reutiliza la misma estructura que panel) -->
  <div class="modal" id="modalPublicar" aria-hidden="true">
    <div class="modal-contenido">
      <h2>Publicar historia</h2>
      <label>TÃ­tulo:</label>
      <input id="titulo" type="text" />
      <label>DescripciÃ³n:</label>
      <textarea id="descripcion"></textarea>
      <label>CategorÃ­a:</label>
      <select id="categoria">
        <option value="aventura">Aventura</option>
        <option value="fantasÃ­a">FantasÃ­a</option>
        <option value="historia">Historia</option>
      </select>

      <label>ğŸ“ Subir archivo de texto (.txt)</label>
      <input type="file" id="archivoTexto" accept=".txt" onchange="cargarTextoArchivo(this)">

      <label>ğŸ–¼ Portada (imagen)</label>
      <input type="file" id="portada" accept="image/*">

      <div class="botones">
        <button onclick="confirmarPublicacion()">âœ… Publicar</button>
        <button onclick="cerrarModal()">âŒ Cancelar</button>
      </div>
    </div>
  </div>

  <!-- MenÃº contextual -->
  <ul id="menu-contextual" class="menu-contextual" style="display:none;">
    <li onclick="eliminarElemento()">ğŸ—‘ Eliminar</li>
    <li onclick="copiarElemento()">ğŸ“‹ Copiar</li>
    <li onclick="guardarComo()">ğŸ’¾ Guardar imagen como</li>
    <li onclick="buscarEnGoogle()">ğŸ” Buscar en Google</li>
  </ul>
  function publicarHistoria(titulo, portadaBase64, urlHistoria) {
    let historias = JSON.parse(localStorage.getItem("historias")) || [];
    historias.push({ titulo: titulo, portada: portadaBase64, url: urlHistoria });
    localStorage.setItem("historias", JSON.stringify(historias));
}

</body>
</html>
